<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard do Administrador - Tecauto</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/heroicons@2.0.13/dist/heroicons.min.js"></script>
    <link rel="stylesheet" href="styles/fonts.css">
    <link rel="stylesheet" href="styles/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body class="bg-gray-100 font-sans">
    <!-- Botão de Alternância de Tema -->
    <button class="toggle-dark-mode fixed top-4 right-4 p-2 rounded-full bg-gray-200 hover:bg-gray-300 transition" onclick="toggleDarkMode()">
        <i class="fas fa-moon"></i>
    </button>

    <!-- Navbar -->
    <nav class="bg-white text-gray-800 p-4 shadow-md">
        <div class="container mx-auto flex justify-between items-center">
            
            <div class="logo">
                <img src="../imagens/Logo Tecauto Azul - Laranja Png-07-07.png" alt="Tecauto Logo">
                <span class="text-xl font-bold">Tecauto Admin</span>
            </div>
            <!-- <div class="flex items-center space-x-4"> -->
                <!-- <img src="https://via.placeholder.com/40" alt="Tecauto Logo" class="h-10">
                <span class="text-xl font-bold">Tecauto Admin</span>
            </div> -->
            <div class="flex space-x-6">
                <a href="../index.html" class="hover:underline">Início</a>
                <a href="../servicos.html" class="hover:underline">Serviços</a>
                <a href="../sobre.html" class="hover:underline">Sobre</a>
                <a href="../contactos.html" class="hover:underline">Contato</a>
                <a href="../horario.html" class="hover:underline">Horário</a>
                <a href="./admin_dashboard.html" class="hover:underline">Dashboard</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto mt-8 p-4 dashboard-section">
        <h1 class="text-4xl font-bold text-primary-color mb-4">Bem-vindo, <span id="username"></span>!</h1>
        <p class="text-lg text-gray-600 mb-6">Você está no controle total. Gerencie usuários, pedidos, ofertas e configurações com facilidade.</p>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-8 dashboard-grid">
            <!-- Gerenciar Usuários -->
            <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition dashboard-card">
                <h3 class="text-xl font-semibold text-gray-800">Gerenciar Usuários</h3>
                <p class="text-gray-600 mt-2">Visualize, edite ou remova usuários da base de dados.</p>
                <a href="./gerirUsuarios.html" class="mt-4 inline-block bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">Gerenciar</a>
            </div>
            <!-- Gerenciar Pedidos -->
            <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition dashboard-card">
                <h3 class="text-xl font-semibold text-gray-800">Gerenciar Pedidos</h3>
                <p class="text-gray-600 mt-2">Acompanhe e atualize o status dos pedidos.</p>
                <a href="./gerirPedidos.html" class="mt-4 inline-block bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">Gerenciar</a>
            </div>
            <!-- Gerenciar Ofertas -->
            <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition dashboard-card">
                <h3 class="text-xl font-semibold text-gray-800">Gerenciar Ofertas</h3>
                <p class="text-gray-600 mt-2">Crie, edite ou remova ofertas.</p>
                <a href="./gerirOfertas.html" class="mt-4 inline-block bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">Gerenciar</a>
            </div>
            <!-- Relatórios -->
            <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition dashboard-card">
                <h3 class="text-xl font-semibold text-gray-800">Relatórios</h3>
                <p class="text-gray-600 mt-2">Veja estatísticas e resumos.</p>
                <a href="#" class="mt-4 inline-block bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">Visualizar</a>
            </div>
            <!-- Configurações -->
            <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition dashboard-card">
                <h3 class="text-xl font-semibold text-gray-800">Configurações</h3>
                <p class="text-gray-600 mt-2">Ajuste configurações gerais.</p>
                <a href="#" class="mt-4 inline-block bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">Configurar</a>
            </div>
            <!-- Excluir Conta -->
            <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition dashboard-card">
                <h3 class="text-xl font-semibold text-gray-800">Excluir Conta</h3>
                <p class="text-gray-600 mt-2 text-sm">Exclua permanentemente sua conta (ação irreversível).</p>
                <button onclick="openModal()" class="mt-4 bg-error-color text-white px-4 py-2 rounded hover:bg-red-700 transition danger-btn">Excluir Agora</button>
            </div>
        </div>

        <!-- Histórico de Atividades -->
        <div class="activity-section">
            <h2>Histórico de Atividades</h2>
             <ul id="atividade-lista">
            <!-- Itens serão preenchidos dinamicamente -->
            </ul>
        </div>
    </main>



    <!-- Notificação -->
    <div id="notification" class="notification hidden fixed bottom-4 right-4 bg-green-500 text-white p-4 rounded shadow-lg"></div>

    <!-- Botão Flutuante WhatsApp -->
    <a href="https://wa.me/258840203487" class="whatsapp-float fixed bottom-4 right-4 bg-green-500 text-white p-4 rounded-full shadow-lg hover:bg-green-600 transition" target="_blank">
        <i class="fab fa-whatsapp text-2xl"></i>
    </a>

    <!-- Footer -->
    <footer class="bg-white text-gray-800 py-8 mt-12">
        <div class="container mx-auto grid grid-cols-1 md:grid-cols-3 gap-8 footer-container">
            <div class="footer-section">
                <h3>Contato</h3>
                <p>Email: tecautooficial@gmail.com</p>
                <p>Telefone: +258 84 020 3487</p>
                <p>Maxaquene, Maputo, Moçambique</p>
            </div>
            <div class="footer-section">
                <h3>Links Úteis</h3>
                <ul class="space-y-2">
                    <li><a href="#" class="hover:underline">Início</a></li>
                    <li><a href="#" class="hover:underline">Serviços</a></li>
                    <li><a href="#" class="hover:underline">Contato</a></li>
                    <li><a href="#" class="hover:underline">Sobre Nós</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Redes Sociais</h3>
                <div class="footer-social">
                    <a href="https://www.facebook.com/share/15yyKTsxhR/" target="_blank"><i class="fab fa-facebook-f"></i></a>
                    <a href="https://x.com/tecautooficial?t=W4VG_b4m9mwdDBjrFe_ZtQ&s=09" target="_blank"><i class="fab fa-twitter"></i></a>
                    <a href="https://www.instagram.com/tecautooficial/" target="_blank"><i class="fab fa-instagram"></i></a>
                    <a href="https://www.linkedin.com/in/tec-auto-55a789377?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=android_app" target="_blank"><i class="fab fa-linkedin-in"></i></a>
                </div>
            </div>
        </div>
        <div class="mt-8 text-center footer-bottom">
            <p>© 2025 Tecauto • Todos os direitos reservados | Desenvolvido pela Tecauto</p>
        </div>
    </footer>

    <script>
        const token = localStorage.getItem('token');
        if (!token) {
            window.location.href = 'login.html';
        }

        function confirmDelete() {
            const notification = document.getElementById('notification');
            notification.textContent = 'Conta excluída com sucesso! (Simulação)';
            notification.className = 'notification success show';
            setTimeout(() => {
                notification.className = 'notification hidden';
            }, 3000);
            closeModal();
        }

        // Função para alternar modo escuro
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const icon = document.querySelector('.toggle-dark-mode i');
            if (document.body.classList.contains('dark-mode')) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
            }
        }

        // Users modal functions
        function openUsersModal() {
            const usersList = document.getElementById('usersList');
            usersList.innerHTML = users.map(user => `
                <div class="flex justify-between items-center p-2 border-b">
                    <span>${user.name} (${user.email})</span>
                    <button onclick="deleteUser(${user.id})" class="bg-red-600 text-white px-2 py-1 rounded hover:bg-red-700">Apagar</button>
                </div>
            `).join('');
            document.getElementById('usersModal').classList.remove('modal-hidden');
            document.getElementById('usersModal').classList.add('modal-visible');
        }

        function closeUsersModal() {
            document.getElementById('usersModal').classList.remove('modal-visible');
            document.getElementById('usersModal').classList.add('modal-hidden');
        }

        function deleteUser(userId) {
            users = users.filter(user => user.id !== userId);
            const notification = document.getElementById('notification');
            notification.textContent = 'Usuário excluído com sucesso! (Simulação)';
            notification.className = 'notification success show';
            setTimeout(() => {
                notification.className = 'notification hidden';
            }, 3000);
            openUsersModal(); // Refresh the list
        }

        // Orders modal functions
        function openOrdersModal() {
            const ordersList = document.getElementById('ordersList');
            ordersList.innerHTML = orders.map(order => `
                <div class="flex justify-between items-center p-2 border-b">
                    <span>Pedido #${order.id}: ${order.product} (${order.status})</span>
                    <button onclick="updateOrderStatus(${order.id})" class="bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700">Atualizar Status</button>
                </div>
            `).join('');
            document.getElementById('ordersModal').classList.remove('modal-hidden');
            document.getElementById('ordersModal').classList.add('modal-visible');
        }

        function closeOrdersModal() {
            document.getElementById('ordersModal').classList.remove('modal-visible');
            document.getElementById('ordersModal').classList.add('modal-hidden');
        }

        function updateOrderStatus(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                order.status = order.status === 'Pendente' ? 'Entregue' : 'Pendente';
                const notification = document.getElementById('notification');
                notification.textContent = `Status do pedido #${orderId} atualizado para ${order.status}! (Simulação)`;
                notification.className = 'notification success show';
                setTimeout(() => {
                    notification.className = 'notification hidden';
                }, 3000);
                openOrdersModal(); // Refresh the list
            }
        }

        // Offers modal functions
        function openOffersModal() {
            const offersList = document.getElementById('offersList');
            offersList.innerHTML = offers.map(offer => `
                <div class="flex justify-between items-center p-2 border-b">
                    <span>${offer.product} (${offer.discount}%)</span>
                    <div>
                        <button onclick="openEditOfferModal(${offer.id})" class="bg-yellow-600 text-white px-2 py-1 rounded hover:bg-yellow-700 mr-2">Editar</button>
                        <button onclick="deleteOffer(${offer.id})" class="bg-red-600 text-white px-2 py-1 rounded hover:bg-red-700">Apagar</button>
                    </div>
                </div>
            `).join('');
            document.getElementById('offersModal').classList.remove('modal-hidden');
            document.getElementById('offersModal').classList.add('modal-visible');
        }

        function closeOffersModal() {
            document.getElementById('offersModal').classList.remove('modal-visible');
            document.getElementById('offersModal').classList.add('modal-hidden');
        }

        function createOffer() {
            const product = document.getElementById('offerProduct').value;
            const discount = document.getElementById('offerDiscount').value;
            if (product && discount) {
                offers.push({ id: offers.length + 1, product, discount: parseInt(discount) });
                document.getElementById('offerProduct').value = '';
                document.getElementById('offerDiscount').value = '';
                const notification = document.getElementById('notification');
                notification.textContent = 'Oferta criada com sucesso! (Simulação)';
                notification.className = 'notification success show';
                setTimeout(() => {
                    notification.className = 'notification hidden';
                }, 3000);
                openOffersModal(); // Refresh the list
            }
        }

        function openEditOfferModal(offerId) {
            const offer = offers.find(o => o.id === offerId);
            if (offer) {
                document.getElementById('editOfferId').value = offer.id;
                document.getElementById('editOfferProduct').value = offer.product;
                document.getElementById('editOfferDiscount').value = offer.discount;
                document.getElementById('editOfferModal').classList.remove('modal-hidden');
                document.getElementById('editOfferModal').classList.add('modal-visible');
            }
        }

        function closeEditOfferModal() {
            document.getElementById('editOfferModal').classList.remove('modal-visible');
            document.getElementById('editOfferModal').classList.add('modal-hidden');
        }

        function saveOffer() {
            const offerId = parseInt(document.getElementById('editOfferId').value);
            const product = document.getElementById('editOfferProduct').value;
            const discount = document.getElementById('editOfferDiscount').value;
            if (product && discount) {
                const offer = offers.find(o => o.id === offerId);
                if (offer) {
                    offer.product = product;
                    offer.discount = parseInt(discount);
                    const notification = document.getElementById('notification');
                    notification.textContent = 'Oferta atualizada com sucesso! (Simulação)';
                    notification.className = 'notification success show';
                    setTimeout(() => {
                        notification.className = 'notification hidden';
                    }, 3000);
                    closeEditOfferModal();
                    openOffersModal(); // Refresh the list
                }
            }
        }

        function deleteOffer(offerId) {
            offers = offers.filter(offer => offer.id !== offerId);
            const notification = document.getElementById('notification');
            notification.textContent = 'Oferta excluída com sucesso! (Simulação)';
            notification.className = 'notification success show';
            setTimeout(() => {
                notification.className = 'notification hidden';
            }, 3000);
            openOffersModal(); // Refresh the list
        }

        async function carregarPedidos() {
            try {
                const response = await fetch('https://amusing-ambition-production.up.railway.app/api/pedidos', {
                    headers: { 'Authorization': 'Bearer ' + token }
                });

                if (!response.ok) throw new Error('Erro na resposta da API: ' + response.status);

                const pedidos = await response.json();
                atualizarAtividades(pedidos);

            } catch (error) {
                console.error('Erro ao carregar pedidos:', error);
                showNotification('Erro ao carregar pedidos.', 'error');
            }
        }

        function atualizarAtividades(pedidos) {
            const lista = document.getElementById('atividade-lista');
            lista.innerHTML = '';

            if (!pedidos || pedidos.length === 0) {
                lista.innerHTML = '<li>Nenhuma atividade registrada.</li>';
                return;
            }

            pedidos.forEach(pedido => {
                const li = document.createElement('li');
                li.textContent = `${new Date(pedido.data).toLocaleString()}: Pedido ${pedido.tipo_de_servico} - Status: ${pedido.status}`;
                lista.appendChild(li);
            });
        }

        document.addEventListener('DOMContentLoaded', carregarPedidos);
    </script>
</body>
</html>