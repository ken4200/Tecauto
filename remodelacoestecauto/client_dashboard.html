<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard do Cliente - Tecauto</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/heroicons@2.0.13/dist/heroicons.min.js"></script>
    <link rel="stylesheet" href="styles/fonts.css">
    <link rel="stylesheet" href="styles/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body>
    <!-- Botão de Alternância de Tema -->
    <button class="toggle-dark-mode" onclick="toggleDarkMode()">
        <i class="fas fa-moon"></i>
    </button>

    <!-- Navbar -->
    <nav class="bg-white text-gray-800 p-4 shadow-md">
        <div class="container mx-auto flex justify-between items-center">
            <div class="logo">
                <img src="../imagens/Logo Tecauto Azul - Laranja Png-07-07.png" alt="Tecauto Logo">
                <span class="text-xl font-bold">Tecauto Cliente</span>
            </div>
            <div class="flex space-x-6">
                <a href="../index.html" class="hover:underline">Início</a>
                <a href="../servicos.html" class="hover:underline">Serviços</a>
                <a href="../sobre.html" class="hover:underline">Sobre</a>
                <a href="../contactos.html" class="hover:underline">Contato</a>
                <a href="../horario.html" class="hover:underline">Horário</a>
                <a href="./client_dashboard.html" class="hover:underline">Dashboard</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container dashboard-section">
        <h1 class="text-4xl font-bold text-primary-color mb-4">Bem-vindo, <span id="username"></span>!</h1>
        <p class="text-lg text-gray-600 mb-6">Explore suas opções pessoais e gerencie suas atividades com facilidade.</p>

        <div class="dashboard-grid">
            <!-- Meu Perfil -->
            <div class="dashboard-card">
                <h3 class="text-xl font-semibold text-gray-800">Meu Perfil</h3>
                <p class="text-gray-600 mt-2">Atualize suas informações pessoais.</p>
                <a href="./perfil.html" class="mt-4 inline-block bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">Editar Perfil</a>
            </div>
            <!-- Meus Pedidos -->
            <div class="dashboard-card">
                <h3 class="text-xl font-semibold text-gray-800">Meus Pedidos</h3>
                <p class="text-gray-600 mt-2">Acompanhe o status dos seus pedidos.</p>
                <a href="./pedidos.html" class="mt-4 inline-block bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">Ver Pedidos</a>
            </div>
            <!-- Solicitar Serviço -->
            <div class="dashboard-card">
                <h3 class="text-xl font-semibold text-gray-800">Solicitar Serviço</h3>
                <p class="text-gray-600 mt-2">Solicite logística, peças ou sistemas personalizados.</p>
                <a href="./solicitar-servico.html" class="mt-4 inline-block bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">Solicitar Agora</a>
            </div>
            <!-- Ofertas Exclusivas -->
            <div class="dashboard-card">
                <h3 class="text-xl font-semibold text-gray-800">Ofertas Exclusivas</h3>
                <p class="text-gray-600 mt-2">Acesse promoções e conteúdos exclusivos.</p>
                <a href="./ofertas.html" class="mt-4 inline-block bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">Ver Ofertas</a>
            </div>
            <!-- Suporte -->
            <div class="dashboard-card">
                <h3 class="text-xl font-semibold text-gray-800">Suporte</h3>
                <p class="text-gray-600 mt-2">Envie mensagens para nossa equipe de suporte.</p>
                <a href="./suporte.html" class="mt-4 inline-block bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">Contato Suporte</a>
            </div>
            <!-- Excluir Conta -->
            <div class="dashboard-card">
                <h3 class="text-xl font-semibold text-gray-800">Excluir Conta</h3>
                <p class="text-gray-600 mt-2 text-sm">Exclua permanentemente sua conta (ação irreversível).</p>
               <button type="button" id="delete-account-btn" class="danger-btn">Excluir Conta</button>
            </div>
        </div>

        <!-- Histórico de Atividades -->
        <div class="activity-section">
            <h2>Histórico de Atividades</h2>
             <ul id="atividade-lista">
            <!-- Itens serão preenchidos dinamicamente -->
            </ul>
        </div>
    </main>

    <!-- Modal de Confirmação -->
    <div id="delete-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <p>Tem certeza que deseja excluir sua conta? Esta ação é irreversível.</p>
            <button id="confirm-delete">Confirmar</button>
            <button id="cancel-delete">Cancelar</button>
        </div>
    </div>

    <!-- Notificação -->
    <div id="notification" class="notification hidden"></div>

    <!-- Botão Flutuante WhatsApp -->
    <a href="https://wa.me/258840203487" class="whatsapp-float" target="_blank">
        <i class="fab fa-whatsapp"></i>
    </a>

    <!-- Footer -->
    <footer class="bg-white text-gray-800 py-8 mt-12">
        <div class="container mx-auto grid grid-cols-1 md:grid-cols-3 gap-8 footer-container">
            <div class="footer-section">
                <h3>Contato</h3>
                <p>Email: tecautooficial@gmail.com</p>
                <p>Telefone: +258 84 020 3487</p>
                <p>Maxaquene, Maputo, Moçambique</p>
            </div>
            <div class="footer-section">
                <h3>Links Úteis</h3>
                <ul class="space-y-2">
                    <li><a href="#" class="hover:underline">Início</a></li>
                    <li><a href="#" class="hover:underline">Serviços</a></li>
                    <li><a href="#" class="hover:underline">Contato</a></li>
                    <li><a href="#" class="hover:underline">Sobre Nós</a></li>
                </ul>
            </div>
            <div class="footer-section">
               <h3>Redes Sociais</h3>
                <div class="footer-social">
                    <a href="https://www.facebook.com/share/15yyKTsxhR/" target="_blank"><i class="fab fa-facebook-f"></i></a>
                    <a href="https://x.com/tecautooficial?t=W4VG_b4m9mwdDBjrFe_ZtQ&s=09" target="_blank"><i class="fab fa-twitter"></i></a>
                    <a href="https://www.instagram.com/tecautooficial/" target="_blank"><i class="fab fa-instagram"></i></a>
                    <a href="https://www.linkedin.com/in/tec-auto-55a789377?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=android_app" target="_blank"><i class="fab fa-linkedin-in"></i></a>
                </div>
            </div>
        </div>
        <div class="mt-8 text-center footer-bottom">
            <p>© 2025 Tecauto • Todos os direitos reservados | Desenvolvido pela Tecauto</p>
        </div>
    </footer>

   <script>
        const token = localStorage.getItem('token');
        if (!token) {
            window.location.href = 'login.html';
        }

        // Função para mostrar notificações (exemplo)
        function showNotification(message, type = 'success') {
            alert(`${type.toUpperCase()}: ${message}`);
        }

        // Função para alternar modo escuro
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const icon = document.querySelector('.toggle-dark-mode i');
            if (document.body.classList.contains('dark-mode')) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
            }
        }

        // Função para carregar pedidos e atualizar a lista de atividades
        async function carregarPedidos() {
            try {
                const response = await fetch('https://amusing-ambition-production.up.railway.app/api/pedidos/usuario', {
                    headers: { 'Authorization': 'Bearer ' + token }
                });

                if (!response.ok) throw new Error('Erro na resposta da API: ' + response.status);

                const pedidos = await response.json();
                atualizarAtividades(pedidos);

            } catch (error) {
                console.error('Erro ao carregar pedidos:', error);
                showNotification('Erro ao carregar pedidos.', 'error');
            }
        }

        function atualizarAtividades(pedidos) {
            const lista = document.getElementById('atividade-lista');
            lista.innerHTML = '';

            if (!pedidos || pedidos.length === 0) {
                lista.innerHTML = '<li>Nenhuma atividade registrada.</li>';
                return;
            }

            pedidos.forEach(pedido => {
                const li = document.createElement('li');
                li.textContent = `${new Date(pedido.data).toLocaleString()}: Pedido ${pedido.tipo_de_servico} - Status: ${pedido.status}`;
                lista.appendChild(li);
            });
        }

         // Exclusão de conta
        document.getElementById('delete-account-btn').addEventListener('click', () => {
                document.getElementById('delete-modal').style.display = 'flex';
            });
            document.getElementById('confirm-delete').addEventListener('click', () => {
                console.log("o user: " + token)
                fetch('https://amusing-ambition-production.up.railway.app/api/apagarUsuario', {
                    method: 'DELETE',
                    headers: { 
                        'Authorization': 'Bearer ' + token,
                    }, 
                    
                })
                .then(() => {
                    localStorage.removeItem('token');
                    showNotification('Conta excluída com sucesso.', 'success');
                    setTimeout(() => window.location.href = 'login.html', 1000);
                })
                .catch(error => {
                    showNotification('Erro ao excluir conta.', 'error');
                    console.error('Erro ao excluir conta:', error);
                });
            });
            document.getElementById('cancel-delete').addEventListener('click', () => {
                document.getElementById('delete-modal').style.display = 'none';
            });

        // Carrega a lista assim que a página carregar
        document.addEventListener('DOMContentLoaded', carregarPedidos);
    </script>
</body>
</html>